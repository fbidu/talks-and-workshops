<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="keywords" content="api, python, django, rest, fbidu" />
    <meta name="description" content="Slides for a workshop on REST APIs" />
    <title>Arquitetura, Especifica√ß√£o e Implementa√ß√£o de APIs REST</title>
    <style>
        @import 'https://fonts.googleapis.com/css?family=Lobster|Kelly+Slab|Raleway|Roboto+Mono';
        .vintage
        {
            background: #425454;
            color: #F4EEB4;
            font-family: 'Raleway', sans-serif;
            line-height: 2em;
            font-size: 1.5em;
        }

        .splash h1{
            font-family: 'Lobster', cursive; !important;
        }

      .vintage h1, .vintage h2{
          color: #ABC39F;
          line-height: 1.3em;
          font-size: 0.5em;
          font-family: 'Kelly Slab';
      }

      .vintage h3
      {
          font-family: 'Raleway', sans-serif;
          font-size: 0.8em;
          line-height: 1em;
      }

      .vintage a {
          color: #55897D;
          text-decoration: none;
      }
      code {
        background: #e7e8e2;
        border-radius: 5px;
        line-height: 1.5em;
      }
      .remark-code, .remark-inline-code { font-family: 'Roboto Mono'; }
      .remark-code-line-highlighted     { background-color: #373832; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: 400;
        margin-bottom: 0;
      }
      .remark-slide-content h1 { font-size: 3em; }
      .remark-slide-content h2 { font-size: 2em; }
      .remark-slide-content h3 { font-size: 1.6em; }
      .footnote {
        position: absolute;
        bottom: 3em;
      }
      li p { line-height: 1.25em; }
      .red { color: #fa0000; }
      .large { font-size: 2em; }

      .pull-left {
        float: left;
        width: 47%;
      }
      .pull-right {
        float: right;
        width: 47%;
      }
      .pull-right ~ p {
        clear: both;
      }
      #slideshow .slide .content code {
        font-size: 0.8em;
      }
      #slideshow .slide .content pre code {
        font-size: 0.9em;
        padding: 15px;
      }

      img {
          max-width: 100%;
          max-height: 100%;
      }

    </style>
  </head>
  <body>
    <textarea id="source">
        class: center, middle, vintage, splash
        # Arquitetura, Especifica√ß√£o e Implementa√ß√£o de APIs REST
        ### por [Felipe Videira Rodrigues](https://felipevr.com)
        ???
        - O nosso tema hoje √© falar sobre APIs REST, o que elas s√£o, pra qu√™ elas servem,
        quais as tecnologias que est√£o envolvidas e como construir uma de forma correta.
        - Boa parte do conte√∫do de hoje serve pra qualquer linguagem de programa√ß√£o.
        S√≥ uma pequena parte do conte√∫do √© espec√≠fica para Python.
        - N√≥s temos alocado um tempo de 8 horas.
        - Nesse tempo, eu preciso cobrir uma parte te√≥rica do assunto mas eu prometo que
        n√£o vou s√≥ ficar passando slides se n√£o todo mundo aqui vai morrer de sono depois de 30min
        - Vou procurar diversificar bastante a apresenta√ß√£o do conte√∫do e ele est√° dispon√≠vel
        integralmente no meu GitHub, fiquem a vontade pra acompanhar como voc√™s preferirem
        seja s√≥ acompanhando a apresenta√ß√£o aqui, fazendo anota√ß√µes, acompanhando no git, etc
        ---
        class: middle, vintage
        # Apresenta√ß√£o
        - Felipe
        - Ci√™ncia da Computa√ß√£o - UNICAMP
        - PyLadies Campinas
        - Desenvolvedor no [LaCTAD/UNICAMP](http://www.lactad.unicamp.br)
        - Infraestrutura na [Devnup](http://devnup.com)
        ???
        - Meu nome √© Felipe, eu tenho 24 anos e fa√ßo ci√™ncia da computa√ß√£o na UNICAMP.
        - Eu t√¥ na programa√ß√£o faz mais ou menos 10 anos e nesse tempo eu j√° passei por
        diversas lingugagens de programa√ß√£o, ferramentas, t√©cnicas e etc at√© que nos √∫ltimos
        anos eu me envolvi com programa√ß√£o em Python e desenvolvimento Web
        - Adicionalmente eu trabalho tamb√©m com infraestrutura, que √© relacionado com
        colocar os c√≥digos 'no ar' e mant√™-los funcionando
        ---
        class: middle, vintage
        # Agenda

        * API? REST?? ‚Äî Motiva√ß√£o
        * GET &amp; 404 ‚Äî Verbos e c√≥digos HTTP
        * JSON &amp; XML ‚Äî Comunica√ß√£o
        * OAUTH &amp; JWT ‚Äî Autentica√ß√£o
        * Blueprint &amp; Swagger ‚Äî Documenta√ß√£o
        * Django, Flask &amp; *Pythonicidade* ‚Äî Implementa√ß√£o
        * Py.test, doctest &amp; unittest ‚Äî Testando seu c√≥digo
        * Heroku, EC2, EBS, Lambda ‚Äî Colocando seu c√≥digo no ar
        * AB ‚Äî Teste de carga
        ---
        class: center, middle, vintage
        # API? REST??
        ### Motiva√ß√£o
        ---
        class: vintage
        # API
        - Um conjunto de estruturas, opera√ß√µes, protocolos e ferramentas para constru√ß√£o de software
        - Uma API define um *contrato*, um pacto entre o usu√°rio da API e o programador
        - Permite que outros programas fa√ßam uso das suas caracter√≠sticas
        ---
        class: vintage
        ## Uma Cafeteira
        - Faz *s√≥ um trabalho* - caf√©
        - Exige o *m√≠nimo necess√°rio* - √°gua, p√≥ de caf√© e energia
        - Depois de alimentada com o input necess√°rio, faz o trabalho
        - Entrega o *resultado esperado*. Nem mais, nem menos
        ---
        class: vintage
        ## E uma cafeteira *com API?*
        - De alguma forma m√°gica n√≥s automatizamos nossa cafeteira e ensinamos Python para ela
        ```python
        import cafeteira
        cafeteira.fa√ßa_caf√©()  # Python 3 ‚ù§
        ```
        - Agora n√≥s temos *acesso program√°tico* para nossa cafeteira
        - Podemos utilizar sua funcionalidade *em nossos c√≥digos!*
        ---
        class: vintage, middle
        ```python
        # 8h da manh√£, hora do caf√©!
        if hora_atual == 8:
            cafeteira.fa√ßa_caf√©()
        ```
        ```python
        # Eu n√£o gosto de n√∫meros √≠mpares, vou fazer um caf√© pra relaxar
        if n % 2:
            cafeteira.fa√ßa_caf√©()
        ```
        ---
        class: vintage
        # APIs Web
        - Permitem que a gente fa√ßa acesso a **recursos remotos**
        - Podemos utilizar de funcionalidades **j√° existentes** em outros servi√ßos dispon√≠veis na Internet
        - Tornam a Internet **program√°vel**
        ---
        class: vintage
        ## Exemplos
        - placekitten ‚Äî Retorna imagens de gatinhos, nas dimens√µes pedidas [`http://placekitten.com/800/600`](http://placekitten.com/800/600)
        - ipify ‚Äî Retorna o seu endere√ßo de IP na Internet [`https://api.ipify.org/`](https://api.ipify.org/)
        - mathjs ‚Äî Faz c√°lculos matem√°ticos [`http://api.mathjs.org/v1/?expr=2*7`](http://api.mathjs.org/v1/?expr=2*7)
        ---
        class: vintage
        ## Exemplos
        - [APIs do Twitter](https://dev.twitter.com/rest/public) ‚Äî Permitem que voc√™ interaja com o servi√ßo de forma bastante ampla - poste novos tweets, busque por tweets, etc
        - [Facebook Graph API](https://developers.facebook.com/docs/graph-api) ‚Äî Analogamente √† API do Twitter, permite que voc√™ execute a√ß√µes dentro do Facebok diretamente do seu c√≥digo - Publique status, fa√ßa upload de imagens, determine se duas pessoas s√£o amigos, liste os eventos que a pessoa foi convidada, etc
        ---
        class: vintage
        # APIs
        ### Qual a vantagem de utilizar APIs?
        ???
        - Como n√≥s vimos, ao utilizar APIs n√≥s reaproveitamos recursos que existem na
        Internet, que foram feitos por outros programadores.
        - Ao reutilizar funcionalidades, economizamos tempo e recursos no nosso lado
        - Se j√° existe uma API que consegue, por exemplo, listar todos os programas de
        TV que est√£o passando em um canal, n√≥s n√£o precisamos gastar tempo buscando e guardando esses dados
        - Ou, por exemplo, se tivermos uma API que nos d√° o CEP de uma rua. N√≥s podemos simplesmente
        utiliz√°-la e n√£o perder tempo montando nosso pr√≥prio banco de dados
        ---
        class: vintage
        # APIs
        ### Qual a vantagem de CRIAR APIs?
        ![why apis](img/api-diagram.png)
        ???
        - Okay, utilizar APIs √© legal mas, por qual motivo eu iria estrutrar meu projeto como uma API?
        - Uma das grandes vantagens √© a reutiliza√ß√£o dos recursos que voc√™ cria em diferentes clientes.
        - Suponha que voc√™ queira criar um projeto novo, um servi√ßo de encontrar vendedores de cachorro-quente perto da casa do usu√°rio
        - Suponha tamb√©m que voc√™ queira que seu servi√ßo seja utiliz√°vel por um navegador, no computador e tamb√©m por um aplicativo Android e outro iOs
        - Se voc√™ estruturar seu c√≥digo como uma API, voc√™ pode programar toda a l√≥gica mais fundamental e pesada uma √∫nica vez
        - Ent√£o voc√™ pode utilizar essa API para alimentar os diferentes clientes que voc√™ vai construir
        - Al√©m de facilitar o desenvolvimento, voc√™ garante de forma f√°cil que todos os clientes v√£o acessar os mesmos dados
        ---
        class: vintage, middle, center
        # REST
        *Representational State Transfer* ‚Äî Transfer√™ncia de Estado de Representa√ß√£o
        ---
        class: vintage, middle, center
        # Hein?
        ---
        class: vintage
        ## REST
        - √â o **padr√£o desej√°vel** de **arquitetura da Internet**
        - Define uma s√©rie de regras que os componentes de um **sistema Web ideal** devem seguir
        - Ao seguir estas regras, o sistema ganha diversas vantagens como **simplicidade**, **escalabilidade**,
        **portabilidade**, **estabilidade**
        ---
        class: vintage
        ## REST
        - Define 5 elementos b√°sicos
        1. Recurso
        2. Identificador de Recurso
        3. Representa√ß√£o
        4. Metadados da Representa√ß√£o
        5. Dados de Controle
        ---
        class: vintage
        ## REST
        ### Recursos e Identificadores de Recurso
        - **Qualquer informa√ß√£o nome√°vel** pode ser considerado um "recurso" -
        uma imagem, um documento, uma pessoa, um servi√ßo, uma cole√ß√£o de outros recursos
        - O Identificador de Recurso √© uma informa√ß√£o - por exemplo um nome - que √© **mapeado para o recurso em si**
        - Por mais que o Recurso em si possa **mudar ao longo do tempo**, o Identificador **sempre** aponta para ele
        ---
        class: vintage
        ## REST
        ### Recursos e Identificadores de Recurso
        - **Identificador** ‚Äî Presidente dos EUA
        - **Recurso** ‚Äî Barack Obama
        - Ano que vem, esse Identificador n√£o apontar√° mais para *Barack Obama* mas
        ainda apontar√° para seja l√° quem for o presidente
        ---
        class: vintage
        ## REST
        ### Recursos e Identificadores de Recurso
        - **Identificador** ‚Äî Tony Ramos
        - **Recurso** ‚Äî Tony Ramos
        - Este Identificador sempre ir√° mapear para a mesma pessoa
        ---
        class: vintage
        ## REST
        ### Recursos e Identificadores de Recurso
        - **Identificador** ‚Äî Pa√≠ses que s√£o membros da Uni√£o Europeia
        - **Recurso** ‚Äî [Fran√ßa, Alemanha, It√°lia, Espanha...]
        - Este Identificador aponta para uma lista de Recursos. Quando a Inglaterra
        completar sua sa√≠da da UE, a lista mudar√° mas o Identificador continuar√°
        apontando para o lugar certo
        ---
        class: vintage
        ## REST
        ### Recursos e Identificadores de Recurso
        - **Identificador** ‚Äî [`http://ecorp.com/financeiro/relatorio_atual`](http://ecorp.com/financeiro/relatorio_atual)
        - **Recurso** ‚Äî O relat√≥rio financeiro do ano atual
        - Independente do ano em que estamos, obteremos o relat√≥rio corrente
        ---
        class: vintage
        ## REST
        ### Recursos e Identificadores de Recurso
        - **Identificador** ‚Äî [`http://ecorp.com/financeiro/relatorio_2010`](http://ecorp.com/financeiro/relatorio_2010)
        - **Recurso** ‚Äî O relat√≥rio financeiro do ano de 2010
        - Sempre obteremos o relat√≥rio de 2010
        ---
        class: vintage
        ## REST
        ### Recursos e Identificadores de Recurso
        - Seja l√° quem nomeou o Recurso √© respons√°vel por garantir o mapeamento entre o
        Identificador e o Recurso em si!
        - Falhas neste mapeamento pode levar a inconsist√™ncias e a erros, como o famoso
        erro **404 N√£o Encontrado**, onde um Identificador n√£o √© mapeado para recurso algum
        ---
        class: vintage
        ## REST
        ### Representa√ß√µes de Recursos
        - √â uma captura do estado atual ou desejado de um Recurso
        ---
        class: vintage
        ## REST
        ### Representa√ß√µes de Recursos
        - **Identificador** ‚Äî Logo do Python
        -  **Representa√ß√£o**:

        ![python logo](img/python-logo.png)
        ---
        class: vintage
        ## REST
        ### Representa√ß√µes de Recursos
        - **Identificador** ‚Äî Logo do Python em Preto
        -  **Representa√ß√£o**:

        ![python logo black](img/python-logo-black.png)
        ---
        class: vintage
        ## REST
        ### Metadados da Representa√ß√£o
        - S√£o informa√ß√µes que qualificam a Representa√ß√£o oferecida
        - Deve ser apresentado em pares de chaves e valores, como num dicion√°rio
        - Podem incluir informa√ß√µes como o formato da representa√ß√£o, o tamanho, etc
        ---
        class: vintage
        ## REST
        ### Metadados da Representa√ß√£o
        .pull-left[
        -  **Representa√ß√£o**:

        ![python logo](img/python-logo.png)
        ]
        .pull-right[
        - **Metadados**:
        ```python
            'tipo': 'PNG',
            'tamanho': '8.6kB'
        ```
        ]
        ---
        class: vintage
        ## REST
        ### Dados de Controle
        - Modificam o comportamento
        - Tamb√©m podemos oferecer dados que permitem ao cliente determinar a 'validade'
        daquela representa√ß√£o
        - Dessa forma o cliente pode fazer um *caching* local do recurso e possivelmente
        economizar recursos computacionais se for pedir pelo mesmo recurso mais de uma vez
        ---
        class: vintage
        ## REST
        ### Dados de Controle
        .pull-left[
        - **Identificador:** Foto do presidente dos EUA
        - **Representa√ß√£o**:

        ![presidente dos EUA](img/obama.jpg)
        ]
        .pull-right[
        - **Metadados**:
        ```python
            'tipo': 'JPG',
            'tamanho': '13.5kB',
            'validade': '20/01/2017'
        ```
        ]
        ---
        class: vintage
        ## REST
        ### Metadados de Controle ‚Äî Cacheamento
        - O cliente guarda a representa√ß√£o at√© a data especificada
        - Caso queira acessar esse recurso novamente, verifica se o conte√∫do j√° 'venceu'
        - Se o conte√∫do ainda √© v√°lido, o cliente economiza recursos pois pode utilizar
        a representa√ß√£o armazenada ao inv√©s de pedir uma nova
        ---
        class: vintage, middle, center
        # GET &amp; 404
        ### O protocolo HTTP
        ---
        class: vintage
        ## Protocolo HTTP
        ### [Mapa Mental](https://atlas.mindmup.com/2016/09/f0aedfa062f00134deff01735469202e/protocolo_http/index.html)
        ---
        class: vintage, middle, center
        # JSON &amp; XML
        ### Comunica√ß√£o
        ---
        class: vintage
        ## JSON &amp; XML
        ### Papo de m√°quina e papo de gente
        ![communication](img/communication.jpg)
        ???
        * O protocolo HTTP define uma forma de empacotar e transmitir mensagens pela rede
        * Cliente e servidor conseguem 'conversar' em HTTP.
        * No entanto, n√≥s precisamos definir tamb√©m uma estrutura para o _conte√∫do_ que iremos transmitir
        * Usualmente, na internet, trabalhamos com HTML. Ele √© bastante √∫til para estruturar o conte√∫do para exibi√ß√£o.
        No entanto, uma API tem necessidades diferentes de um navegador.
        * Uma API normalmente n√£o vai ser consumida diretamente por um ser humano mas sim por um front-end, que vai ser uma camada 'gr√°fica' sobre a API.
        * N√≥s n√£o precisamos, portanto, formatar o conte√∫do em termos de cores, tipos e tamanhos de fonte, etc. Essas coisas s√£o delegadas para o front-end
        * No entanto, temos necessidades adicionais em rela√ß√£o ao HTML. N√≥s precisamos, por exemplo, definir dados booleanos, num√©ricos, listas de dados, etc.
        * O padr√£o mais utilizado para isso atualmente √© o JSON
        ---
        class: vintage
        ## JSON &amp; XML
        ### Exemplo de JSON
        ```json
        {
            "nome": "Felipe",
            "idade": 24,
            "altura": 1.88,
            "programa em Python": true,
            "bandas favoritas": [
                "Pink Floyd",
                "Led Zeppelin"
            ],
            "contatos": {
                "email": "felipe@felipevr.com",
                "github": "https://github.com/fbidu",
                "site": "http://felipevr.com"
            }
        }
        ```
        ???
        * Observe como temos uma estrutura de dicion√°rio, no formato chaves-valores,
        muito parecida com o dicion√°rio nativo do Python!
        * Observe tamb√©m como temos valores com tipos de dados diferentes. Strings,
        Inteiros, Decimais, Booleanos, Listas e at√© mesmo um objeto dentro do outro
        ---
        class: vintage
        ## JSON &amp; XML
        ### Serializa√ß√£o e Deserializa√ß√£o
        .pull-left[
        ```python
        j = Pessoa()
        j.nome = 'Jo√£o'
        j.idade = 23
        j.altura = 1.70
        j.bandas_favoritas = ['U2']
        (...)
        ```
        ]
        .pull-right[
        ```json
            {
                "nome": "Jo√£o",
                "idade": 23,
                "altura": 1.70,
                "bandas favoritas": [
                    "U2"
                ]
                (...)
            }
        ```
        ]
        ???
        * No lado esquerdo temos uma inst√¢ncia do classe pessoa. Ela possui seus atributos definidos e tudo mais.
        * No entanto, n√£o √© poss√≠vel simplesmente transmitir ou salvar esses dados para usar depois no jeito em que eles est√£o.
        * √â necess√°rio converter aquele objeto, que existe dentro do Python,
        em alguma coisa que possa ser salva, seja num arquivo ou num banco de dados, por exemplo
        * Esse processo √© chamado de serializa√ß√£o.
        * A serializa√ß√£o consiste em transformar uma estrutura de dados, um objeto, em alguma coisa que possa ser salva ou transmitida
        e que depois a gente possa reconstruir o objeto original com base no que foi armazenado.
        * Existem serializa√ß√µes que geram formatos bin√°rios, pouco leg√≠veis para humanos mas bastante compactos e bastante leg√≠veis por m√°quinas
        * N√≥s podemos utilizar o JSON para serializar objetos em um formato de texto, que √© leg√≠vel tanto por humanos quanto por m√°quinas.
        * O texto gerado pode ser transmitido, armazenado, lido e reconstru√≠do para um objeto original
        ---
        class: vintage
        ## JSON &amp; XML
        ### Juntando as coisas
        * Temos agora tr√™s conhecimentos importantes - O padr√£o REST, o protocolo HTTP e o formato JSON.
        * O REST nos diz como estruturar, como pensar nossa API.
        * O HTTP, como nossa API pode se comunicar com o resto do mundo
        * O JSON, como n√≥s vamos estruturar as mensagens que nossa API ir√° enviar e receber.
        ???
        * Bom, fazendo uma revis√£o r√°pida do que temos at√© aqui. REST, HTTP e JSON.
        * Atualmente esse trio √© utilizado na maioria das APIs. No entanto,
        observem que nenhum deles *obriga* a utiliza√ß√£o de nenhum dos outros dois
        ---
        class: vintage
        ## JSON &amp; XML
        ```xml
            <?xml version="1.0" encoding="ISO-8859-1"?>
            <receita nome="p√£o" tempo_de_preparo="5 minutos" tempo_de_cozimento="1 hora">
              <titulo>P√£o simples</titulo>
              <ingredientes>
                <ingrediente quantidade="3" unidade="x√≠caras">Farinha</ingrediente>
                <ingrediente quantidade="7" unidade="gramas">Fermento</ingrediente>
                <ingrediente quantidade="1.5" unidade="x√≠caras" estado="morna">√Ågua</ingrediente>
                <ingrediente quantidade="1" unidade="colheres de ch√°">Sal</ingrediente>
              </ingredientes>
              <instrucoes>
                <passo>Misture todos os ingredientes, e dissolva bem.</passo>
                <passo>Cubra com um pano e deixe por uma hora em um local morno.</passo>
                <passo>Misture novamente, coloque numa bandeja e asse num forno.</passo>
              </instrucoes>
            </receita>
            ```
        ---
        class: vintage, middle, center
        # OAUTH &amp; JWT
        ### Autentica√ß√£o
        ---
        class: vintage
        ## OAUTH &amp; JWT
        ### Autentica√ß√£o vs Autoriza√ß√£o
        ![Home](img/homer-id.jpg)
        ???
        * S√£o dois processos diferentes mas que muitos confundem
        * Autentica√ß√£o diz respeito a confirmar que uma pessoa de fato √© quem ela diz que √©
        * Autoriza√ß√£o √© determinar que uma pessoa - j√° devidamente autenticada - pode executar uma determinada a√ß√£o
        * Suponha que voc√™ foi numa festa a fantasia com seu amigo, que est√° fantasiado de Homem de Ferro, com m√°scara e tudo
        * Ent√£o seu amigo pede pra voc√™ guardar a carteira dele enquanto ele vai ao banheiro
        * Depois de um tempo, chega uma pessoa fantasiada de Homem de Ferro e fala "d√° minha carteira"
        * Voc√™ fica na d√∫vida: √© mesmo seu amigo?
        * S√≥ o seu amigo tem *autoriza√ß√£o* para acessar aquela carteira
        * No entanto, voc√™ precisa primeiro *autenticar* que aquela pessoa fantasiada √© o seu amigo
        * Quando a pessoa fantasiada arrancar a m√°scara, voc√™ vai de fato autenticar se aquela pessoa √© seu amigo ou n√£o
        * Se ela for, voc√™ entrega a carteira. Caso contr√°rio, voc√™ segura
        * No mundo "f√≠sico" autentica√ß√µes s√£o feitas usando documentos como o RG
        * No meio digital, o meio mais comum de autentica√ß√£o s√£o usu√°rios e senhas
        ---
        class: vintage
        ## OAUTH &amp; JWT
        ### Basic Auth
        ```
        http://usu√°rio:senha@servidor.com
        ```
        ![basic auth](img/basic-auth.svg)
        ???
        * √â a forma mais b√°sica de autentica√ß√£o na Internet
        * Em cada chamada voc√™ passa o usu√°rio e a senha para autentica√ß√£o
        * √â extremamente simples e f√°cil de ser implementado
        * Para aplica√ß√µes bem simples ainda √© utilizado. No entanto, alguns cuidados devem ser tomados
        * O protocolo HTTP n√£o criptografa nada por padr√£o, ent√£o qualquer ponto no
        'meio do caminho' entre o cliente e o servidor poder√° interceptar o nome de usu√°rio e a senha
        ---
        class: vintage
        ## OAUTH &amp; JWT
        ### Autentica√ß√µes e Autoriza√ß√µes por Token
        ![token auth](img/token-auth.svg)
        ???
        * Diversas implementa√ß√µes diferentes
        * Basicamente o usu√°rio n√£o mais fornece suas credenciais da API para o cliente
        * O usu√°rio pede a um servidor de autentica√ß√£o para gerar um token, que √© basicamente um texto, uma string.
        * Nesse pedido, o usu√°rio conta pro servidor de autentica√ß√£o, em nome de *qual cliente*
        ele est√° gerando aquele token e quais a√ß√µes o usu√°rio quer permitir que o cliente execute em seu nome
        * O usu√°rio vai se autenticar nesse servidor com as suas credenciais, este servidor ir√° valid√°-las
        e ent√£o ir√° gerar esse token, guardando ele atrelado √† conta do usu√°rio
        * O servidor de autentica√ß√£o envia esse token para o cliente
        * A partir desse momento, o cliente vai utilizar esse token para autenticar suas chamadas √† API feitas
        em nome do usu√°rio
        * A API, ao receber uma chamada do cliente, pega o token e consulta de qual usu√°rio √© aquele token
        para fazer a autentica√ß√£o e quais permiss√µes o usu√°rio deu para o portador daquele token
        ---
        class: vintage, middle, center
        ## OAUTH &amp; JWT
        ### Tokens vs Basic Auth
        ???
        * Algumas diferen√ßas importantes. A primeira √© que o usu√°rio n√£o mais envia as credenciais da sua conta
        ao cliente, mas sim a um servidor de autentica√ß√£o
        * Outro ponto importante, no basic auth se um usu√°rio utilizasse 3 clientes diferentes para uma API, por exemplo
        um cliente Android, um no navegador e outro numa Smart TV
        * Nesse cen√°rio, como as mesmas credenciais s√£o usadas para todos os clientes, o usu√°rio n√£o consegue remover
        o acesso de apenas um desses clientes. O m√°ximo que ele pode fazer √© mudar a pr√≥pria senha, revogando o acesso
        de todos eles
        * Com uma autentica√ß√£o baseada em tokens, o usu√°rio pode revogar o acesso de apenas um aplicativo cliente
        * Mais uma quest√£o importante - o usu√°rio pode dar √† clientes diferentes,
        autoriza√ß√µes diferentes sobre sua conta.
        * Outro ponto interessante √© que com tokens, o usu√°rio e a API podem saber qual *cliente*
        executou uma determinada a√ß√£o em nome do usu√°rio pois cada token √© gerado para
        um cliente espec√≠fico
        * Atualmente, a maioria das APIs utiliza alguma estrutura de autentica√ß√£o baseada em tokens
        ---
        class: vintage
        ## OAUTH &amp; JWT
        ### OAUTH como pseudo-autoriza√ß√£o
        ![pseudoauth](img/pseudoauth.png)
        ---
        class: vintage
        ## OAUTH &amp; JWT
        ### OAUTH2
        * Define 4 elementos
        1. Propriet√°rio do Recurso
        2. Cliente
        3. Servidor de Recursos
        4. Servidor de Autoriza√ß√µes
        ---
        class: vintage
        ## OAUTH &amp; JWT
        ### OAUTH2 - Fluxo
        ![token auth](img/oauth2.png)
        ???
        * A aplica√ß√£o pede ao usu√°rio acesso a um determinado recurso
        * Se o usu√°rio autoriza, a aplica√ß√£o recebe uma 'concess√£o de autoriza√ß√£o'
        * A aplica√ßao requisita um token de acesso do servidor de autoriza√ß√£o,
        apresentando uma autentica√ß√£o de si pr√≥pria e a concess√£o do cliente
        * Se a identidade da aplica√ß√£o e a concess√£o de autoriza√ß√£o s√£o v√°lidos,
        o servidor de autoriza√ß√£o emite um token de acesso para a aplica√ß√£o
        * A aplica√ß√£o requisita um recurso da API e apresenta o token de acesso
        * Se o token √© v√°lido, a API retorna o recurso pedido
        ---
        class: vintage
        ## OAUTH &amp; JWT
        ### OAUTH - Brincando com OAUTH de verdade!
        [API do Twitter](https://dev.twitter.com/)
        [API do Facebook](https://developers.facebook.com/)
        ---
        class: vintage
        ## OAUTH &amp; JWT
        ### *Man in the Middle*
        ![token auth](img/communication.png)
        ???
        * Normalmente n√≥s percebemos a comunica√ß√£o como sendo simples assim
        * Do lado esquerdo podemos ter, por exemplo, voc√™ no seu navegador querendo abrir a p√°gina
        inicial do Google e do lado direito o servidor do Google
        * A nossa percep√ß√£o √© de que n√≥s enviamos um pedido para o servidor e ele responde
        * Em linhas gerais √© realmente isso que acontece mas n√≥s precisamos dar um 'zoom'
        nessa conex√£o entre os pontos
        ---
        class: vintage
        ## OAUTH &amp; JWT
        ### *Man in the Middle*
        ![token auth](img/real-communication.png)
        ???
        * Essa figura √© mais pr√≥xima da realidade
        * Entre o cliente e o servidor, existem dezenas de outros computadores
        * Antes de um pedido ou de uma resposta chegar ao seu destino, ela passa por todos eles
        * Pode ser o seu roteador de wifi, os computadores do seu provedor de internet, do provedor de internet
        do servidor de destino, etc etc
        * Como d√° pra gente ver, existem v√°rios pontos no 'meio' da comunica√ß√£o entre o cliente e o servidor
        * Al√©m disso, numa comunica√ß√£o HTTP comum eu posso adicionar MAIS pontos entre quaisquer desses que j√°
        existem sem que a comunica√ß√£o sofra
        * Tudo isso tem rela√ß√£o com um tipo de ataque de seguran√ßa chamado 'Man in the Middle' ou,
        literalmente, 'Homem no Meio'
        ---
        class: vintage
        ## OAUTH &amp; JWT
        ### *Man in the Middle*
        ![token auth](img/mitm.png)
        ???
        * Nesse cen√°rio, um ataquente se posiciona no meio da comunica√ß√£o
        * Dessa posi√ß√£o ele consegue interceptar tudo o que √© transmitido entre o cliente e o servidor
        * Ele pode ent√£o fazer todo tipo de coisas divertidas - registrar as transa√ß√µes pedidas, igual
        quando um telefone √© 'grampeado', pode alterar as informa√ß√µes transmitidas, censur√°-las, etc
        * Seja l√° qual for o mecanismo de autentica√ß√£o que o cliente e o servidor da API utilizarem,
        se eles utilizarem do protocolo HTTP sem adicionar nada a mais de seguran√ßa, tudo o que for
        transmitido entre cliente e servidor ser√° intercept√°vel por um atacante
        * Se voc√™ usar Basic Auth, o atacante ir√° ver as credenciais no formato `usu√°rio:senha@servidor`
        * Se voc√™ usar qualquer forma de autentica√ß√£o via token, o atacante poder√° roubar esse token
        ---
        class: vintage
        ## OAUTH &amp; JWT
        ### *Man in the Cloud*
        ![token auth](img/man-in-cloud.jpg)
        ???
        * O ataque de *Man in the Cloud* foi descrito pela primeira vez pela Imperva,
        na confer√™ncia BlackHat de 2015
        * Nas autentica√ß√µes via token, o aplicativo cliente recebe um token e o armazena
        para uso posterior
        * O ataque √© baseado no roubo dessas credenciais que as vezes s√£o armazenadas de forma irregular
        * Esse token roubado pode ser utilizado para fazer chamadas devidamente autenticadas
        * Observe que o *Man in the Middle* √© focado em informa√ß√µes em tr√¢nsito, enquanto o *Man in the Cloud*,
        em informa√ß√µes armazenadas
        * Isso √© mais uma evid√™ncia de como a seguran√ßa dos nossos sistemas √© uma coisa que n√≥s devemos abordar
        de uma forma abrangente e cuidadosa
        ---
        class: vintage
        ## OAUTH &amp; JWT
        ### HTTPS
        ![https](img/https.png)
        ???
        * Em linhas bem gerais, √© uma camada de seguran√ßa sobre a comunica√ß√£o HTTP normal
        * Nos permite garantir que as infor√ß√£oes transmitidas entre cliente e servidor n√£o sejam lidas
        nem modificads por outras pesoaSSS
        ---
        class: vintage, middle, center
        # Blueprint &amp; Swagger
        ### Documenta√ß√£o
        ---
        class: vintage
        ## Blueprint &amp; Swagger
        ### Documente uma vez, atualize primeiro.
        ---
        class: vintage
        ## Blueprint &amp; Swagger
        ### Mock Servers ou *como tirar o time de front-end do seu p√©?*
        ---
        class: vintage, middle, center
        # Django, Flask &amp; *Pythonicidade*
        ### Implementa√ß√£o
        ---
        class: vintage
        ## Django, Flask &amp; *Pythonicidade*
        ### Zen do Python e REST
        ---
        class: vintage
        ## Django, Flask &amp; *Pythonicidade*
        ### Microframeworks, macroframeworks
        ---
        class: vintage
        ## Django, Flask &amp; *Pythonicidade*
        ### Projeto exemplo
        ---
        class: vintage
        ## Django, Flask &amp; *Pythonicidade*
        ### Django REST Framework
        ---
        class: vintage
        ## Django, Flask &amp; *Pythonicidade*
        ### Django OAUTH Toolkit
        ---
        class: vintage, middle, center
        # Py.test, doctest &amp; unittest
        ### Testando seu c√≥digo
        ---
        class: vintage
        ## Py.test, doctest &amp; unittest
        ### Testar pra qu√™?
        ---
        class: vintage
        ## Py.test, doctest &amp; unittest
        ### Testes unit√°rios e testes de integra√ß√£o
        ---
        class: vintage
        ## Py.test, doctest &amp; unittest
        ### E os bancos de dados?
        ---
        class: vintage, middle, center
        # Heroku &amp; EC2
        ### Colocando seu c√≥digo no ar
        ---
        class: vintage
        ## Heroku &amp; EC2
        ### Cloud, PaaS, SaaS e outros nomes pra impressionar a galera
        ---
        class: vintage
        ## Heroku &amp; EC2
        ### Heroku
        ---
        class: vintage
        ## Heroku &amp; EC2
        ### EC2/DigitalOcean
        ---
        class: vintage, middle, center
        # AB
        ### Teste de carga
        ---
        class: vintage
        ## AB
        ### Centenas de requests simult√¢neos!
        ---
        class: vintage, middle, center
        # Fontes
        ---
        class: vintage
        - [**Architectural Styles and the Design of Network-based Software Architectures**](http://www.ics.uci.edu/~fielding/pubs/dissertation/fielding_dissertation.pdf)
        - [**FAQ sobre HTTP/2**](https://http2.github.io/faq/)
        - [**The HTTP OPTIONS method and potential for self-describing RESTful APIs**](http://zacstewart.com/2012/04/14/http-options-method.html)
        - [**REST CookBook**](http://restcookbook.com/)
        - [**Build APIs You Won't Hate**](https://apisyouwonthate.com/)
        - [**Introduction to REST and .Net Web API**](https://blogs.msdn.microsoft.com/martinkearn/2015/01/05/introduction-to-rest-and-net-web-api/)
        - [**JSON**](http://www.json.org/json-pt.html)
        - [**JSON API**](http://jsonapi.org/)
        - [**Man in the Cloud**](https://www.imperva.com/docs/HII_Man_In_The_Cloud_Attacks.pdf)
        ---
        class: vintage, middle, center
        # Obrigado üòÑ

</textarea>
<script src="http://gnab.github.io/remark/downloads/remark-latest.min.js" type="text/javascript"></script>
<script>
  var hljs = remark.highlighter.engine;
</script>
<script src="remark.language.js"></script>
<script>
  var slideshow = remark.create({
      highlightStyle: 'monokai',
      highlightLanguage: 'remark',
      highlightLines: true
    }) ;
</script>
</body>
</html>
